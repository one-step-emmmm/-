<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»ˆæœ«åœ°åŸºè´¨åˆ·å–å¤§å¸ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 32px;
        }

        .section {
            margin-bottom: 40px;
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .weapon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .weapon-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .weapon-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .weapon-card.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .weapon-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .weapon-attrs {
            font-size: 12px;
            opacity: 0.9;
        }

        .weapon-attrs div {
            margin: 3px 0;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .result {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
        }

        .result-item {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result-item h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .result-detail {
            margin: 10px 0;
            font-size: 15px;
            color: #495057;
        }

        .result-detail strong {
            color: #333;
        }

        .weapon-list {
            margin-top: 15px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 5px;
        }

        .weapon-list span {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            margin: 3px;
            font-size: 13px;
        }

        .probability {
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            display: inline-block;
            margin-top: 10px;
            font-weight: bold;
        }

        .no-selection {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            font-size: 18px;
        }

        .selected-count {
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            color: #667eea;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .weapon-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ç»ˆæœ«åœ°åŸºè´¨åˆ·å–å¤§å¸ˆ</h1>

        <div class="section">
            <h2>é€‰æ‹©æ­¦å™¨</h2>
            <div class="selected-count">
                å·²é€‰æ‹© <span id="selectedCount">0</span> æŠŠæ­¦å™¨
            </div>
            <div class="weapon-grid" id="weaponGrid"></div>
            <div class="button-group">
                <button class="btn-primary" onclick="calculateOptimalStrategy()">è®¡ç®—æœ€ä¼˜ç­–ç•¥</button>
                <button class="btn-secondary" onclick="selectAll()">å…¨é€‰</button>
                <button class="btn-secondary" onclick="clearSelection()">æ¸…ç©ºé€‰æ‹©</button>
            </div>
        </div>

        <div class="section">
            <h2>æœ€ä¼˜åˆ·å–ç­–ç•¥</h2>
            <div id="result"></div>
        </div>
    </div>

    <script>
        const weapons = [
            { name: 'å®æ„¿', base: 'æ•æ·æå‡', additional: 'æ”»å‡»æå‡', skill: 'é™„æœ¯' },
            { name: 'ä¸çŸ¥å½’', base: 'æ„å¿—æå‡', additional: 'æ”»å‡»æå‡', skill: 'æµè½¬' },
            { name: 'ç†”é“¸ç«ç„°', base: 'æ™ºè¯†æå‡', additional: 'æ”»å‡»æå‡', skill: 'å¤œå¹•' },
            { name: 'é»¯è‰²ç«ç‚¬', base: 'æ™ºè¯†æå‡', additional: 'ç¼çƒ­ä¼¤å®³æå‡', skill: 'é™„æœ¯' },
            { name: 'æ‰¶æ‘‡', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'æš´å‡»ç‡æå‡', skill: 'å¤œå¹•' },
            { name: 'çƒ­ç†”åˆ‡å‰²å™¨', base: 'æ„å¿—æå‡', additional: 'æ”»å‡»æå‡', skill: 'æµè½¬' },
            { name: 'æ˜¾èµ«å£°æ˜', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'ç‰©ç†ä¼¤å®³æå‡', skill: 'æ®‹æš´' },
            { name: 'ç™½å¤œæ–°æ˜Ÿ', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'æºçŸ³æŠ€è‰ºå¼ºåº¦æå‡', skill: 'é™„æœ¯' },
            { name: 'æ²§æºŸæ˜Ÿæ¢¦', base: 'æ™ºè¯†æå‡', additional: 'æ²»ç–—æ•ˆç‡æå‡', skill: 'é™„æœ¯' },
            { name: 'ä½¿å‘½å¿…è¾¾', base: 'æ„å¿—æå‡', additional: 'ç»ˆç»“æŠ€å……èƒ½æ•ˆç‡æå‡', skill: 'è¿½è¢­' },
            { name: 'ä½œå“ï¼šèš€è¿¹', base: 'æ„å¿—æå‡', additional: 'è‡ªç„¶ä¼¤å®³æå‡', skill: 'å‹åˆ¶' },
            { name: 'çˆ†ç ´å•å…ƒ', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'æºçŸ³æŠ€è‰ºå¼ºåº¦æå‡', skill: 'è¿¸å‘' },
            { name: 'é—å¿˜', base: 'æ™ºè¯†æå‡', additional: 'æ³•æœ¯æå‡', skill: 'å¤œå¹•' },
            { name: 'éª‘å£«ç²¾ç¥', base: 'æ„å¿—æå‡', additional: 'ç”Ÿå‘½æå‡', skill: 'åŒ»ç–—' },
            { name: 'è‰ºæœ¯æš´å›', base: 'æ™ºè¯†æå‡', additional: 'æš´å‡»ç‡æå‡', skill: 'åˆ‡éª¨' },
            { name: 'é¢†èˆªè€…', base: 'æ™ºè¯†æå‡', additional: 'å¯’å†·ä¼¤å®³æå‡', skill: 'é™„æœ¯' },
            { name: 'æ¥”å­', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'æš´å‡»ç‡æå‡', skill: 'é™„æœ¯' },
            { name: 'åŒç±»ç›¸é£Ÿ', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'æ³•æœ¯æå‡', skill: 'é™„æœ¯' },
            { name: 'å¤§é›·æ–‘', base: 'åŠ›é‡æå‡', additional: 'ç”Ÿå‘½æå‡', skill: 'åŒ»ç–—' },
            { name: 'å…¸èŒƒ', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'æ”»å‡»æå‡', skill: 'å‹åˆ¶' },
            { name: 'æ˜”æ—¥ç²¾å“', base: 'æ„å¿—æå‡', additional: 'ç”Ÿå‘½æå‡', skill: 'æ•ˆç›Š' },
            { name: 'ç ´ç¢å›ç‹', base: 'åŠ›é‡æå‡', additional: 'æš´å‡»ç‡æå‡', skill: 'ç²‰ç¢' },
            { name: 'è´Ÿå±±', base: 'æ•æ·æå‡', additional: 'ç‰©ç†ä¼¤å®³æå‡', skill: 'æ•ˆç›Š' },
            { name: 'éªå‹‡', base: 'æ•æ·æå‡', additional: 'ç‰©ç†ä¼¤å®³æå‡', skill: 'å·§æŠ€' },
            { name: 'èµ«æ‹‰èŠ¬æ ¼', base: 'åŠ›é‡æå‡', additional: 'æ”»å‡»æå‡', skill: 'è¿¸å‘' },
            { name: 'J.E.T.', base: 'ä¸»èƒ½åŠ›æå‡', additional: 'æ”»å‡»æå‡', skill: 'å‹åˆ¶' }
        ];

        const zones = {
            'æ¢çº½åŒº': {
                base: ['æ•æ·æå‡', 'åŠ›é‡æå‡', 'æ„å¿—æå‡', 'æ™ºè¯†æå‡', 'ä¸»èƒ½åŠ›æå‡'],
                additional: ['æ”»å‡»æå‡', 'ç¼çƒ­ä¼¤å®³æå‡', 'ç”µç£ä¼¤å®³æå‡', 'å¯’å†·ä¼¤å®³æå‡', 'è‡ªç„¶ä¼¤å®³æå‡', 'æºçŸ³æŠ€è‰ºå¼ºåº¦æå‡', 'ç»ˆç»“æŠ€å……èƒ½æ•ˆç‡æå‡', 'æ³•æœ¯æå‡'],
                skill: ['å¼ºæ”»', 'å‹åˆ¶', 'è¿½è¢­', 'ç²‰ç¢', 'å·§æŠ€', 'è¿›å‘', 'æµè½¬', 'æ•ˆç›Š']
            },
            'æºçŸ³ç ”ç©¶å›­': {
                base: ['æ•æ·æå‡', 'åŠ›é‡æå‡', 'æ„å¿—æå‡', 'æ™ºè¯†æå‡', 'ä¸»èƒ½åŠ›æå‡'],
                additional: ['æ”»å‡»æå‡', 'ç‰©ç†ä¼¤å®³æå‡', 'ç”µç£ä¼¤å®³æå‡', 'å¯’å†·ä¼¤å®³æå‡', 'è‡ªç„¶ä¼¤å®³æå‡', 'æš´å‡»ç‡æå‡', 'ç»ˆç»“æŠ€å……èƒ½æ•ˆç‡æå‡', 'æ³•æœ¯æå‡'],
                skill: ['å‹åˆ¶', 'è¿½è¢­', 'æ˜‚æ‰¬', 'å·§æŠ€', 'é™„æœ¯', 'åŒ»ç–—', 'åˆ‡éª¨', 'æ•ˆç›Š']
            },
            'çŸ¿è„‰å›­åŒº': {
                base: ['æ•æ·æå‡', 'åŠ›é‡æå‡', 'æ„å¿—æå‡', 'æ™ºè¯†æå‡', 'ä¸»èƒ½åŠ›æå‡'],
                additional: ['ç”Ÿå‘½æå‡', 'ç‰©ç†ä¼¤å®³æå‡', 'ç¼çƒ­ä¼¤å®³æå‡', 'å¯’å†·ä¼¤å®³æå‡', 'è‡ªç„¶ä¼¤å®³æå‡', 'æš´å‡»ç‡æå‡', 'æºçŸ³æŠ€è‰ºå¼ºåº¦æå‡', 'æ²»ç–—æ•ˆç‡æå‡'],
                skill: ['å¼ºæ”»', 'å‹åˆ¶', 'å·§æŠ€', 'æ®‹æš´', 'é™„æœ¯', 'è¿›å‘', 'å¤œå¹•', 'æ•ˆç›Š']
            },
            'ä¾›èƒ½é«˜åœ°': {
                base: ['æ•æ·æå‡', 'åŠ›é‡æå‡', 'æ„å¿—æå‡', 'æ™ºè¯†æå‡', 'ä¸»èƒ½åŠ›æå‡'],
                additional: ['æ”»å‡»æå‡', 'ç”Ÿå‘½æå‡', 'ç‰©ç†ä¼¤å®³æå‡', 'ç¼çƒ­ä¼¤å®³æå‡', 'è‡ªç„¶ä¼¤å®³æå‡', 'æš´å‡»ç‡æå‡', 'æºçŸ³æŠ€è‰ºå¼ºåº¦æå‡', 'æ²»ç–—æ•ˆç‡æå‡'],
                skill: ['è¿½è¢­', 'ç²‰ç¢', 'æ˜‚æ‰¬', 'æ®‹æš´', 'é™„æœ¯', 'åŒ»ç–—', 'åˆ‡éª¨', 'æµè½¬']
            },
            'æ­¦é™µåŸ': {
                base: ['æ•æ·æå‡', 'åŠ›é‡æå‡', 'æ„å¿—æå‡', 'æ™ºè¯†æå‡', 'ä¸»èƒ½åŠ›æå‡'],
                additional: ['æ”»å‡»æå‡', 'ç”Ÿå‘½æå‡', 'ç”µç£ä¼¤å®³æå‡', 'å¯’å†·ä¼¤å®³æå‡', 'æš´å‡»ç‡æå‡', 'ç»ˆç»“æŠ€å……èƒ½æ•ˆç‡æå‡', 'æ³•æœ¯æå‡', 'æ²»ç–—æ•ˆç‡æå‡'],
                skill: ['å¼ºæ”»', 'ç²‰ç¢', 'æ®‹æš´', 'åŒ»ç–—', 'åˆ‡éª¨', 'è¿›å‘', 'å¤œå¹•', 'æµè½¬']
            }
        };

        let selectedWeapons = [];

        function initWeaponGrid() {
            const grid = document.getElementById('weaponGrid');
            grid.innerHTML = '';
            
            weapons.forEach((weapon, index) => {
                const card = document.createElement('div');
                card.className = 'weapon-card';
                card.onclick = () => toggleWeapon(index);
                
                card.innerHTML = `
                    <div class="weapon-name">${weapon.name}</div>
                    <div class="weapon-attrs">
                        <div>åŸºç¡€: ${weapon.base}</div>
                        <div>é™„åŠ : ${weapon.additional}</div>
                        <div>æŠ€èƒ½: ${weapon.skill}</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function toggleWeapon(index) {
            const card = document.querySelectorAll('.weapon-card')[index];
            
            if (selectedWeapons.includes(index)) {
                selectedWeapons = selectedWeapons.filter(i => i !== index);
                card.classList.remove('selected');
            } else {
                selectedWeapons.push(index);
                card.classList.add('selected');
            }
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedWeapons.length;
        }

        function selectAll() {
            selectedWeapons = weapons.map((_, index) => index);
            document.querySelectorAll('.weapon-card').forEach(card => {
                card.classList.add('selected');
            });
            updateSelectedCount();
        }

        function clearSelection() {
            selectedWeapons = [];
            document.querySelectorAll('.weapon-card').forEach(card => {
                card.classList.remove('selected');
            });
            updateSelectedCount();
            document.getElementById('result').innerHTML = '';
        }

        function countSatisfiedWeapons(weaponList, zoneName, selectedBases, fixedAttrType, fixedAttrValue) {
            const zoneAttrs = zones[zoneName];
            let count = 0;
            const satisfied = [];
            
            for (const weaponIndex of weaponList) {
                const weapon = weapons[weaponIndex];
                
                const baseMatch = selectedBases.includes(weapon.base);
                
                let addMatch, skillMatch;
                if (fixedAttrType === 'additional') {
                    addMatch = weapon.additional === fixedAttrValue;
                    skillMatch = zoneAttrs.skill.includes(weapon.skill) || (weapon.skill === 'è¿¸å‘' && zoneAttrs.skill.includes('è¿›å‘'));
                } else {
                    addMatch = zoneAttrs.additional.includes(weapon.additional);
                    skillMatch = weapon.skill === fixedAttrValue || (weapon.skill === 'è¿¸å‘' && fixedAttrValue === 'è¿›å‘');
                }
                
                if (baseMatch && addMatch && skillMatch) {
                    count++;
                    satisfied.push(weapon.name);
                }
            }
            
            return { count, satisfied };
        }

        function getCombinations(arr, size) {
            const result = [];
            
            function combine(start, combo) {
                if (combo.length === size) {
                    result.push([...combo]);
                    return;
                }
                
                for (let i = start; i < arr.length; i++) {
                    combo.push(arr[i]);
                    combine(i + 1, combo);
                    combo.pop();
                }
            }
            
            combine(0, []);
            return result;
        }

        function calculateOptimalStrategy() {
            const resultDiv = document.getElementById('result');
            
            if (selectedWeapons.length === 0) {
                resultDiv.innerHTML = '<div class="no-selection">è¯·å…ˆé€‰æ‹©æ­¦å™¨</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">è®¡ç®—ä¸­...</div>';
            
            setTimeout(() => {
                requestAnimationFrame(() => {
                    let bestConfig = null;
                    let bestCount = 0;
                    let bestSatisfied = [];
                    const allConfigs = [];
                    
                    for (const [zoneName, zoneAttrs] of Object.entries(zones)) {
                        const baseCombinations = getCombinations(zoneAttrs.base, 3);
                        
                        for (const baseCombo of baseCombinations) {
                            for (const fixedAttr of zoneAttrs.additional) {
                                const { count, satisfied } = countSatisfiedWeapons(
                                    selectedWeapons, zoneName, baseCombo, 'additional', fixedAttr
                                );
                                
                                allConfigs.push({
                                    zone: zoneName,
                                    bases: baseCombo,
                                    fixedType: 'additional',
                                    fixedValue: fixedAttr,
                                    count,
                                    satisfied
                                });
                                
                                if (count > bestCount) {
                                    bestCount = count;
                                    bestConfig = {
                                        zone: zoneName,
                                        bases: baseCombo,
                                        fixedType: 'additional',
                                        fixedValue: fixedAttr
                                    };
                                    bestSatisfied = satisfied;
                                }
                            }
                            
                            for (const fixedAttr of zoneAttrs.skill) {
                                const { count, satisfied } = countSatisfiedWeapons(
                                    selectedWeapons, zoneName, baseCombo, 'skill', fixedAttr
                                );
                                
                                allConfigs.push({
                                    zone: zoneName,
                                    bases: baseCombo,
                                    fixedType: 'skill',
                                    fixedValue: fixedAttr,
                                    count,
                                    satisfied
                                });
                                
                                if (count > bestCount) {
                                    bestCount = count;
                                    bestConfig = {
                                        zone: zoneName,
                                        bases: baseCombo,
                                        fixedType: 'skill',
                                        fixedValue: fixedAttr
                                    };
                                    bestSatisfied = satisfied;
                                }
                            }
                        }
                    }
                    
                    const randomPoolSize = bestConfig.fixedType === 'additional' 
                        ? zones[bestConfig.zone].skill.length 
                        : zones[bestConfig.zone].additional.length;
                    
                    const singleProbability = 1 / (3 * randomPoolSize);
                    const anyProbability = bestCount * singleProbability;
                    const anyProbabilityPercent = (anyProbability * 100).toFixed(2);
                    
                    const bestConfigs = allConfigs.filter(config => config.count === bestCount);
                    
                    let html = `
                        <div class="result-item">
                            <h3>ğŸ† æœ€ä¼˜åˆ·å–ç­–ç•¥</h3>
                            <div class="result-detail">
                                <strong>åŒºåŸŸï¼š</strong>${bestConfig.zone}
                            </div>
                            <div class="result-detail">
                                <strong>é€‰æ‹©çš„ä¸»å±æ€§ï¼š</strong>${bestConfig.bases.join('ã€')}
                            </div>
                            <div class="result-detail">
                                <strong>é€‰æ‹©çš„å›ºå®šå±æ€§ï¼š</strong>${bestConfig.fixedType === 'additional' ? 'é™„åŠ å±æ€§' : 'æŠ€èƒ½å±æ€§'} - ${bestConfig.fixedValue}
                            </div>
                            <div class="result-detail">
                                <strong>å¯æ»¡è¶³çš„æ­¦å™¨æ•°é‡ï¼š</strong>${bestCount}/${selectedWeapons.length}
                            </div>
                            <div class="weapon-list">
                                <strong>å¯æ»¡è¶³çš„æ­¦å™¨ï¼š</strong><br>
                                ${bestSatisfied.map(w => `<span>${w}</span>`).join('')}
                            </div>
                            <div class="probability">
                                æ»¡è¶³ä»»æ„ä¸€æŠŠæ­¦å™¨çš„æ¦‚ç‡ï¼š${anyProbabilityPercent}%
                            </div>
                        </div>
                    `;
                    
                    if (bestConfigs.length > 1) {
                        html += `
                            <div class="result-item">
                                <h3>ğŸ“‹ æ‰€æœ‰æ»¡è¶³${bestCount}æŠŠæ­¦å™¨çš„é…ç½®</h3>
                        `;
                        
                        bestConfigs.forEach((config, index) => {
                            html += `
                                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                                    <div class="result-detail"><strong>é…ç½® ${index + 1}ï¼š</strong></div>
                                    <div class="result-detail">åŒºåŸŸï¼š${config.zone}</div>
                                    <div class="result-detail">ä¸»å±æ€§ï¼š${config.bases.join('ã€')}</div>
                                    <div class="result-detail">å›ºå®šå±æ€§ï¼š${config.fixedType === 'additional' ? 'é™„åŠ å±æ€§' : 'æŠ€èƒ½å±æ€§'} - ${config.fixedValue}</div>
                                    <div class="weapon-list">
                                        ${config.satisfied.map(w => `<span>${w}</span>`).join('')}
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += '</div>';
                    }
                    
                    resultDiv.innerHTML = html;
                });
            }, 50);
        }

        initWeaponGrid();
    </script>
</body>
</html>
